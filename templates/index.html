<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hurricane Marty - Prototype</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background: url('../static/hurricane_marty_Background.jpg') no-repeat center center fixed;
        background-size: cover;
        color: #fff;
    }
    header {
        text-align: center;
        padding: 1.5rem;
        background-color: rgba(0,0,0,0.5);
    }
    header h1 {
        margin: 0;
        font-size: 2rem;
    }
    #controls {
        text-align: center;
        margin: 1rem;
    }
    button {
        background-color: #ff6b6b;
        color: #fff;
        border: none;
        padding: 0.6rem 1.2rem;
        cursor: pointer;
        font-size: 1rem;
        border-radius: 8px;
        margin: 0.5rem;
    }
    #preview {
        width: 90%;
        max-width: 1000px;
        margin: 2rem auto;
        background-color: rgba(0,0,0,0.6);
        padding: 1rem;
        border-radius: 10px;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        color: #fff;
    }
    th, td {
        padding: 0.5rem;
        border-bottom: 1px solid #fff;
        text-align: left;
    }
    #map {
        height: 400px;
        width: 90%;
        max-width: 1000px;
        margin: 2rem auto;
        border-radius: 10px;
    }
</style>
</head>
<body>

<header>
    <h1>Hurricane Marty - Prototype</h1>
</header>

<div id="controls">
    <button onclick="loadData()">Load Addresses</button>
    <button onclick="downloadCSV()">Download CSV</button>
</div>

<div id="preview">
    <h2>Preview of Addresses</h2>
    <table id="addressTable">
        <thead>
            <tr>
                <th>Number</th>
                <th>Street</th>
                <th>Unit</th>
                <th>City</th>
                <th>Latitude</th>
                <th>Longitude</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<div id="map"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
<script>
let addresses = [];
let map = L.map('map').setView([25.92, -81.65], 15);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19
}).addTo(map);

function loadData() {
    fetch('/api/addresses')
        .then(res => res.json())
        .then(data => {
            addresses = data.features.map(f => ({
                number: f.properties.number || '',
                street: f.properties.street || '',
                unit: f.properties.unit || '',
                city: f.properties.city || '',
                lat: f.geometry.coordinates[1],
                lng: f.geometry.coordinates[0]
            }));
            populateTable();
            populateMap();
        })
        .catch(err => alert("Failed to load data: " + err));
}

function populateTable() {
    const tbody = document.querySelector('#addressTable tbody');
    tbody.innerHTML = '';
    addresses.slice(0, 10).forEach(a => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${a.number}</td>
            <td>${a.street}</td>
            <td>${a.unit}</td>
            <td>${a.city}</td>
            <td>${a.lat}</td>
            <td>${a.lng}</td>
        `;
        tbody.appendChild(tr);
    });
}

function populateMap() {
    addresses.forEach(a => {
        L.marker([a.lat, a.lng]).addTo(map)
            .bindPopup(`${a.number} ${a.street} ${a.unit || ''}`);
    });
}

function downloadCSV() {
    window.location.href = '/api/download/addresses';
}
</script>

</body>
</html>
