<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Hurricane Marty</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
  body { 
    font-family: Arial; 
    background: url('hurricane_marty_Background.jpg'); 
    background-size: cover; 
    margin: 0;
    padding: 0;
  }

  /* Hurricane Marty banner */
  .hurricane-banner {
    position: relative; /* anchor point for orbiters */
    font-size: 3.5em;
    font-weight: bold;
    text-align: center;
    padding: 60px 10px;
    color: yellow;
    text-shadow: 3px 3px 8px red, -3px -3px 8px blue;
    background: rgba(0,0,0,0.6);
    overflow: hidden;
    animation: shake 0.8s infinite, spinColors 5s linear infinite;
  }

  @keyframes shake {
    0% { transform: rotate(1deg) translateX(2px); }
    25% { transform: rotate(-1deg) translateX(-2px); }
    50% { transform: rotate(2deg) translateX(2px); }
    75% { transform: rotate(-2deg) translateX(-2px); }
    100% { transform: rotate(1deg) translateX(2px); }
  }

  @keyframes spinColors {
    0% { color: yellow; }
    25% { color: cyan; }
    50% { color: lime; }
    75% { color: orange; }
    100% { color: yellow; }
  }

  /* Orbiting hurricane emojis */
  .orbit {
    position: absolute;
    top: 50%;
    left: 50%;
    font-size: 2em;
    transform-origin: center -120px;
    animation: orbit 6s linear infinite;
  }
  .orbit2 {
    transform-origin: center -160px;
    animation: orbit2 8s linear infinite;
  }
  .orbit3 {
    transform-origin: center -200px;
    animation: orbit3 10s linear infinite;
  }

  @keyframes orbit {
    0% { transform: rotate(0deg) translateX(120px) rotate(0deg); }
    100% { transform: rotate(360deg) translateX(120px) rotate(-360deg); }
  }
  @keyframes orbit2 {
    0% { transform: rotate(0deg) translateX(160px) rotate(0deg); }
    100% { transform: rotate(360deg) translateX(160px) rotate(-360deg); }
  }
  @keyframes orbit3 {
    0% { transform: rotate(0deg) translateX(200px) rotate(0deg); }
    100% { transform: rotate(360deg) translateX(200px) rotate(-360deg); }
  }

  table { 
    border-collapse: collapse; 
    width: 100%; 
    background: rgba(255,255,255,0.9);
    margin-top: 20px;
  }
  th, td { 
    border: 1px solid #999; 
    padding: 8px; 
    text-align: left; 
  }
  #map { height: 400px; margin-top: 20px; }
  .download-btn { 
    margin-top: 10px; 
    padding: 10px 20px; 
    background: #ff5722; 
    color: white; 
    border: none; 
    cursor: pointer; 
    font-size: 1.1em;
    border-radius: 8px;
  }
  .download-btn:hover {
    background: #e64a19;
  }
</style>
</head>
<body>
<div class="hurricane-banner">
  ðŸŒŠ Hurricane Marty ðŸŒŠ
  <div class="orbit">ðŸŒª</div>
  <div class="orbit orbit2">ðŸŒª</div>
  <div class="orbit orbit3">ðŸŒª</div>
</div>

<div id="table-container"></div>
<button class="download-btn" onclick="downloadCSV()">Download CSV</button>
<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
async function loadAddresses() {
    try {
        const res = await fetch("/api/addresses");
        const data = await res.json();
        if(data.error) throw new Error(data.error);

        const features = data.features || [];
        let html = '<table><tr><th>Number</th><th>Street</th><th>Unit</th><th>City</th><th>Latitude</th><th>Longitude</th></tr>';
        features.slice(0, 20).forEach(f => {
            const props = f.properties;
            const coords = f.geometry.coordinates;
            html += `<tr>
                <td>${props.number||''}</td>
                <td>${props.street||''}</td>
                <td>${props.unit||''}</td>
                <td>${props.city||''}</td>
                <td>${coords[1]}</td>
                <td>${coords[0]}</td>
            </tr>`;
        });
        html += '</table>';
        document.getElementById("table-container").innerHTML = html;

        // Map
        const map = L.map('map').setView([25.925, -81.65], 16);
        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19
        }).addTo(map);

        features.forEach(f => {
            const coords = f.geometry.coordinates;
            L.marker([coords[1], coords[0]]).addTo(map);
        });

    } catch(e) {
        document.getElementById("table-container").innerHTML = `<p style="color:red;">Failed to load data: ${e.message}</p>`;
    }
}

function downloadCSV() {
    window.location.href = "/api/download/addresses";
}

loadAddresses();
</script>
</body>
</html>
